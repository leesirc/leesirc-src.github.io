+++
title="子网掩码"
tags=["网络"]
categories=["网络"]
date="2020-10-11T12:00:00+08:00"
toc=true

+++

<!-- 概要 -->
子网掩码划分
<!--more-->


今天在使用ipcalc工具给业务划分vpc时, 突然蒙蔽了, 对具体的子网掩码划分概念太模糊了, 果然出来混迟早需要还的, 主要有以下疑问点:

+ 如何根据主机数量进行划分子网
+ 如何根据现有的子网划分再接着划分新的子网

## 1.概念

### ipcalc

这个工具用来子网划分真的很爽

+ ipcalc <cidr>
+ ipcalc <cidr> -s <hosts_num01> <hosts_num02>

```shell
 ~/ ipcalc 10.10.0.0/16
Address:   10.10.0.0            00001010.00001010. 00000000.00000000
Netmask:   255.255.0.0 = 16     11111111.11111111. 00000000.00000000
Wildcard:  0.0.255.255          00000000.00000000. 11111111.11111111
=>
Network:   10.10.0.0/16         00001010.00001010. 00000000.00000000
HostMin:   10.10.0.1            00001010.00001010. 00000000.00000001
HostMax:   10.10.255.254        00001010.00001010. 11111111.11111110
Broadcast: 10.10.255.255        00001010.00001010. 11111111.11111111
Hosts/Net: 65534                 Class A, Private Internet
```

上面demo说明:
+ 网段: 10.10.0.0/16
+ 网络位: 255.255.0.0
+ 主机位: 0.0.255.255
+ 主机数量: 2^16 -2 ~= 65534

```shell
 ~/ ipcalc 10.10.0.0/16 -s 100
Address:   10.10.0.0            00001010.00001010. 00000000.00000000
Netmask:   255.255.0.0 = 16     11111111.11111111. 00000000.00000000
Wildcard:  0.0.255.255          00000000.00000000. 11111111.11111111
=>
Network:   10.10.0.0/16         00001010.00001010. 00000000.00000000
HostMin:   10.10.0.1            00001010.00001010. 00000000.00000001
HostMax:   10.10.255.254        00001010.00001010. 11111111.11111110
Broadcast: 10.10.255.255        00001010.00001010. 11111111.11111111
Hosts/Net: 65534                 Class A, Private Internet

1. Requested size: 100 hosts
Netmask:   255.255.255.128 = 25 11111111.11111111.11111111.1 0000000
Network:   10.10.0.0/25         00001010.00001010.00000000.0 0000000
HostMin:   10.10.0.1            00001010.00001010.00000000.0 0000001
HostMax:   10.10.0.126          00001010.00001010.00000000.0 1111110
Broadcast: 10.10.0.127          00001010.00001010.00000000.0 1111111
Hosts/Net: 126                   Class A, Private Internet

Needed size:  128 addresses.
Used network: 10.10.0.0/25
Unused:
10.10.0.128/25
10.10.1.0/24
10.10.2.0/23
10.10.4.0/22
10.10.8.0/21
10.10.16.0/20
10.10.32.0/19
10.10.64.0/18
10.10.128.0/17
```

上面demo说明:
1. 将网络10.10.0.0/16 进行子网划分出一个子网, 根据主机数量为100进行划分, 由上面图例可以知道: ipcalc 工具是根据最小主机数量进行划分的, 最小为2^7, 因为主机位数为7, 网络位数为25, 即 最小的子网为 10.10.0.0/25
2. 又因为网络10.10.0.0/16 为16位掩码, 因为网络位就剩下9位, 因为也就有了2^9 -1 == 516这样的子网, 且掩码都是25位的, 每个小的子网的空闲网络位逐次递增即可
3. 若每个子网承载主机数量为100, 那我们轻松知道, 按照25位掩码分即可:
10.10.0.0/25
10.10.0.128/25
10.10.1.0/25
10.10.1.128/25

可以通过 ~/ ipcalc 10.10.0.0/16 -s 100 100 100 100 进行验证上述答案

### 子网掩码概念

```shell
# 摘抄自百科
子网掩码不能单独存在，它必须结合IP地址一起使用。子网掩码只有一个作用，就是将某个IP地址划分成网络地址和主机地址两部分

通过计算机的子网掩码判断两台计算机是否属于同一网段的方法是，将计算机十进制的IP地址和子网掩码转换为二进制的形式，然后进行二进制“与”(AND)计算（全1则得1，不全1则得0），如果得出的结果是相同的，那么这两台计算机就属于同一网段
```


## 2.原理

```yaml
网络位: 掩码与IP地址进行AND运算
主机位: 掩码取反后, 与IP地址进行AND运算

```

## 3.应用

### 根据主机数

```shell
# 摘抄自百科
根据主机数
利用主机数来计算
1)将主机数目转化为二进制来表示
2)如果主机数小于或等于254（注意去掉保留的两个IP地址），则取得该主机的二进制位数，为 N，这里肯定N<8。如果大于254，则 N>8，这就是说主机地址将占据不止8位。
3)使用255.255.255.255来将该类IP地址的主机地址位数全部置1，然后从后向前的将N位全部置为 0，即为子网掩码值。
如欲将B类IP地址168.195.0.0划分成若干子网，每个子网内有主机700台：
1) 700=1010111100
2)该二进制为十位数，N = 10
3)将该B类地址的子网掩码255.255.0.0的主机地址全部置1，得到255.255.255.255
然后再从后向前将后10位置0，即为： 11111111.11111111.11111100.00000000
即255.255.252.0。这就是该欲划分成主机为700台的B类IP地址168.195.0.0的子网掩码

# 总而言之
给一个主机承载数量, 先算出2^N次方的最小N数, 这个N就是主机位
```